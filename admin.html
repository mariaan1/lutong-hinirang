<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <link href="admin.css" rel="stylesheet" type="text/css">
</head>
<body>

<header>
        <div class="logo">
            <a href="home.html"><img src="litratos/1-logo.png" alt="Lutong Hinirang Logo"></a>
        </div>            
        <nav>
            <div class="menu-button" id="menu-button">
                <img src="/lutong-hinirang/litratos/hamburger-symbol.png" alt="Menu" />
            </div>
            <ul id="navbar-links">
                <li><a href="public.html">Dashboard</a></li>
                <li><a href="menu.html">Menu</a></li>
                <li><a href="luzon.html">Luzon</a></li>
                <li><a href="visayas.html">Visayas</a></li>
                <li><a href="mindanao.html">Mindanao</a></li>
                <li><a href="portfolio.html">Portfolio Content</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="nutrition_chart.html">Nutrition Chart</a></li>
                <li><a href="login.html">Login</a></li>
                <li><a href="signup.html">Sign Up</a></li>
                <li><a href="admin.html">Admin</a></li>
            </ul>
        </nav>
    </header>

<div class="welcome-section">
    <div class="welcome-content">
        <h1>Admin Panel</h1>

        <div id="loginForm">
    <label for="adminUser">Username:</label>
    <input type="text" id="adminUser" autocomplete="off" autocapitalize="none" placeholder="Enter admin username" />
    <label for="adminPass">Password:</label>
    <input type="password" id="adminPass" placeholder="Enter admin password" />
    <button onclick="adminLogin()">Login</button>
  </div>
<br><br>
  <div id="navBar" class="hidden">
    <button onclick="location.href='login.html'">Login</button>
    <button onclick="location.href='signup.html'">Sign Up</button>
    <button onclick="location.href='public.html'">Public Recipes</button>
  </div>

  <div id="adminControls" class="hidden">
    <button onclick="logoutAdmin()">Logout Admin</button>
  </div>

  <div id="userPassList" class="hidden">
    <h2>Registered Users</h2>
    <pre id="usersDisplay"></pre>
  </div>

  <div id="recipesList" class="hidden">
    <h2>All User Recipes</h2> <br>
    <div id="recipesContainer"></div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="hidden">
    <h3>Edit Recipe</h3>
    <label>Title:</label>
    <input type="text" id="editTitle" />
    
    <label>Ingredients / Content (use new lines for list items):</label>
    <textarea id="editContent" rows="6"></textarea>
    
    <label>Upload Image:</label>
    <input type="file" id="editImage" accept="image/*" />
    
    <div style="margin-top: 15px; text-align: right;">
      <button onclick="saveEdit()">Save</button>
      <button onclick="closeEditModal()" style="background-color: #ccc; color: black; margin-left: 10px;">Cancel</button>
    </div>
  </div>
  <div id="modalOverlay" class="hidden"></div>
  </div>
</div>
<div class="credits">
        <div class="names">
            <div>
                <p>Maria Anifur Bautista // Clyde Galban<br> Patrick Laureen Guinto // Benedict Ledesma</p>
            </div>
            <div>
                <h3>BSCPE 402</h3>
            </div>
        </div>
    </div>
<script>

 document.getElementById('menu-button').addEventListener('click', function () {
            document.getElementById('navbar-links').classList.toggle('active');
        });

        document.addEventListener('click', function (event) {
            const menuButton = document.getElementById('menu-button');
            const navbarLinks = document.getElementById('navbar-links');

            if (!menuButton.contains(event.target) && !navbarLinks.contains(event.target)) {
                navbarLinks.classList.remove('active');
            }
        });

  const adminCreds = { username: 'admin', password: 'admin123' };

  function adminLogin() {
    const user = document.getElementById('adminUser').value.trim().toLowerCase();
    const pass = document.getElementById('adminPass').value;

    if (user === adminCreds.username && pass === adminCreds.password) {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('navBar').classList.remove('hidden');
      document.getElementById('adminControls').classList.remove('hidden');
      document.getElementById('userPassList').classList.remove('hidden');
      document.getElementById('recipesList').classList.remove('hidden');
      displayUsers();
      displayRecipes();
    } else {
      alert('Wrong Username or Password');
    }
  }

  function logoutAdmin() {
    document.getElementById('loginForm').classList.remove('hidden');
    document.getElementById('navBar').classList.add('hidden');
    document.getElementById('adminControls').classList.add('hidden');
    document.getElementById('userPassList').classList.add('hidden');
    document.getElementById('recipesList').classList.add('hidden');
    document.getElementById('adminUser').value = '';
    document.getElementById('adminPass').value = '';
  }

  function displayUsers() {
    const users = JSON.parse(localStorage.getItem('users') || '{}');
    let text = '';
    for (const username in users) {
      text += `${username} : ${users[username]}\n`;
    }
    document.getElementById('usersDisplay').textContent = text || 'No users registered yet.';
  }

  function displayRecipes() {
    const recipes = JSON.parse(localStorage.getItem('recipes') || '{}');
    const container = document.getElementById('recipesContainer');
    container.innerHTML = '';

    for (const user in recipes) {
      recipes[user].forEach((r, i) => {
        const div = document.createElement('div');
        div.className = 'recipe';
        const contentList = r.content.split('\n').map(line => `<li>${line}</li>`).join('');
        div.innerHTML = `
          <em>By: ${user}</em><br><br>
          <strong>${r.title}</strong><br>
          <ul>${contentList}</ul><br>
          ${r.image ? `<img src="${r.image}" alt="Recipe Image">` : ''}
          <button onclick="editRecipe('${user}', ${i})">Edit</button>
          <button onclick="deleteRecipe('${user}', ${i})">Delete</button>
        `;
        container.appendChild(div);
      });
    }
  }

  let editUser = null, editIndex = null;

  function editRecipe(u, i) {
    editUser = u;
    editIndex = i;
    
    const recipes = JSON.parse(localStorage.getItem('recipes') || '{}');
    const r = recipes[u][i];
    
    document.getElementById('editTitle').value = r.title;
    document.getElementById('editContent').value = r.content;
    document.getElementById('editImage').value = ''; // reset file input
    
    document.getElementById('editModal').classList.remove('hidden');
    document.getElementById('modalOverlay').classList.remove('hidden');
  }

  function closeEditModal() {
    document.getElementById('editModal').classList.add('hidden');
    document.getElementById('modalOverlay').classList.add('hidden');
  }

  function saveEdit() {
    const newTitle = document.getElementById('editTitle').value.trim();
    const newContent = document.getElementById('editContent').value.trim();
    const imageInput = document.getElementById('editImage');
    const recipes = JSON.parse(localStorage.getItem('recipes') || '{}');
    let recipe = recipes[editUser][editIndex];
    
    if (!newTitle) {
      alert('Title cannot be empty');
      return;
    }

    recipe.title = newTitle;
    recipe.content = newContent;

    if (imageInput.files && imageInput.files[0]) {
      const file = imageInput.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        recipe.image = e.target.result; // base64 image string
        
        recipes[editUser][editIndex] = recipe;
        localStorage.setItem('recipes', JSON.stringify(recipes));
        displayRecipes();
        closeEditModal();
      };
      reader.readAsDataURL(file);
    } else {
      // No new image, keep existing
      recipes[editUser][editIndex] = recipe;
      localStorage.setItem('recipes', JSON.stringify(recipes));
      displayRecipes();
      closeEditModal();
    }
  }

  function deleteRecipe(u, i) {
    if (confirm('Delete this recipe?')) {
      const recipes = JSON.parse(localStorage.getItem('recipes') || '{}');
      recipes[u].splice(i, 1);
      if (recipes[u].length === 0) delete recipes[u];
      localStorage.setItem('recipes', JSON.stringify(recipes));
      displayRecipes();
    }
  }
</script>
</body>
</html>